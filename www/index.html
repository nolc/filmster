<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

        <!--
 <script type="text/javascript" src="js/lib/att.js"></script>
        <script type="text/javascript" src="js/lib/jquery.json-2.3.1.js"></script>
        <script type="text/javascript" src="js/lib/jquery.mobile-1.1.1.js"></script>
        <script type="text/javascript" src="js/lib/require.js"></script>
    -->

          <link rel="stylesheet" href="css/jquery.mobile-1.2.0.min.css" />
            <script type="text/javascript" src="js/AudioRecord.js"></script>
        <link rel="stylesheet" type="text/css" href="css/index.css" />



        <title>Hello World</title>
        <script>


    // Called when capture operation is finished
    //
    function captureSuccess(mediaFiles) {
        var i, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            uploadFile(mediaFiles[i]);
        }
    }

    // Called if something bad happens.
    //
    function captureError(error) {
        var msg = 'An error occurred during capture: ' + error.code;
        navigator.notification.alert(msg, null, 'Uh oh!');
    }

    // A button will call this function
    //
    function captureAudio() {
        // Launch device audio recording application,
        // allowing user to capture up to 2 audio clips
        navigator.device.capture.captureAudio(captureSuccess, captureError, {limit: 2});
    }

    // Upload files to server
    function uploadFile(mediaFile) {
        var ft = new FileTransfer(),
            path = mediaFile.fullPath,
            name = mediaFile.name;

        ft.upload(path,
            "http://96.126.120.48/chrono/uploadaudio/save.php",
            function(result) {
                console.log('Upload success: ' + result.responseCode);
                console.log(result.bytesSent + ' bytes sent');
            },
            function(error) {
                console.log('Error uploading file ' + path + ': ' + error.code);
            },
            { fileName: name });
    }















// Record audio
    //
    function recordAudio() {
        var src = "test.wav";
        var mediaRec = new Media(src, onSuccess, onError);

        // Record audio
        mediaRec.startRecord();

        // Stop recording after 10 sec
        var recTime = 0;
        var recInterval = setInterval(function() {
            recTime = recTime + 1;
            setAudioPosition(recTime + " sec");
            if (recTime >= 10) {
                clearInterval(recInterval);
                mediaRec.stopRecord();
            }
        }, 1000);
    }

    // Cordova is ready
    //
    function empieza() {
        recordAudio();
    }

    // onSuccess Callback
    //
    function onSuccess() {
        console.log("recordAudio():Audio Success");
    }

    // onError Callback
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }

    // Set audio position
    //
    function setAudioPosition(position) {
        document.getElementById('audio_position').innerHTML = position;
    }











        </script>
    </head>
    <body onload="onLoad();">


               <div data-role="page" id="page_dashboard">

               <div data-role="header">
               <h1>Dashboard</h1>
               </div>

              <div data-role="content">
                  <p><a onclick="showAlert(); return false;" data-role="button" id="button_page_create">hola mundo </a></p>


                <button onclick="captureAudio();">Capture Audio</button>


                <button onclick="empieza();">empieza</button>

                <button onclick="stopRecording();">stop</button>





 <p id="media">Recording audio...</p>
    <p id="audio_position"></p>



              </div>

              </div>



        <script type="text/javascript" src="cordova-2.7.0.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script src="js/jquery-1.8.3.min.js"></script>

                <script src="js/jquery.mobile-1.2.0.min.js"></script>


        <script type="text/javascript">
            app.initialize();
        </script>
    </body>
</html>
